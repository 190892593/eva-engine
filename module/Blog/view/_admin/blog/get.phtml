<?
$post = $this->post;
$title = $post['id'] ? 'Edit Post' : 'Create Post';
$method = $post['id'] ? 'put' : 'post';
$this->headTitle($title, 'SET');
if($this->form){
	$form = $this->form;
} else {
    $form = Eva\Api::_()->getForm('\Blog\Form\PostForm');
}
$form->setSubForms(array(
    'Text' => array('Blog\Form\TextForm'),
));
$form->init(array(
    'action' => $this->uri('/admin/blog/'),
    'method' => $method,
    'values' => $this->post
));


//Form usage:
//is error
//$form->subForm('Text')->get('content')->getMessages() ? 'error' : '';
//$form->isError(array('Text', 'content'))


//$this->input($form->subForm('Text')->get('content'), array(
//    'type' => 'formTextarea',
//    'class' => 'span9',
//    'rows' => '15',
//))
//$fomr->input(array('Text', 'content'), 'formTextarea', array('class' => 'span9','rows' => '15',))
?>

<div class="row">
<form <?=$this->formAttr($form)?>>
    <?=$form->restful();?>
    <?=$form->input('id');?>
    <div class="span10">
        <div class="slate">
            <div class="page-header">
                <h2><?=$title?></h2>
            </div>
            <fieldset class="">
                <div class="control-group <?=$form->isError('title') ? 'error' : '';?>">
                    <label class="control-label"><?=$form->get('title')->getAttribute('label');?></label>
                    <div class="controls docs-input-sizes">
                        <?=$form->input('title', array('class' => 'span9'))?>
                        <p class="help-block"><?=$form->input('title', 'formElementErrors')?></p>
                    </div>
                </div>

                <div class="control-group <?=$form->isError(array('Text', 'content')) ? 'error' : '';?>">
                    <label class="control-label"><?=$this->formLabel($form->subForm('Text')->get('content'));?></label>
                    <div class="controls">
                        <?=$form->input(array('Text', 'content'), 'formTextarea', array('class' => 'span9','rows' => '15',))?>
                    </div>
                    <?foreach($form->subForm('Text')->get('content')->getMessages() as $message):?>
                    <p class="help-block"><?=$message?></p>
                    <?endforeach?>
                </div>
            </fieldset>
        </div>
    </div><!--span10 end-->

    <div class="span5">
        <div class="slate">
            <div class="page-header">
                <h3>Post Setting</h3>
            </div>
            <fieldset class="form-horizontal">

                <div class="control-group <?=$form->get('urlName')->getMessages() ? 'error' : '';?>">
                    <label class="control-label"><?=$this->formLabel($form->get('urlName'));?></label>
                    <div class="controls docs-input-sizes">
                        <?=$form->input('urlName', array('class' => 'input-xlarge'))?>
                        <?foreach($form->get('urlName')->getMessages() as $message):?>
                        <p class="help-block"><?=$message?></p>
                        <?endforeach?>
                    </div>
                </div>


                <div class="control-group">
                    <label class="control-label"><?=$this->formLabel($form->get('status'));?></label>
                    <div class="controls">
                        <?=$form->input('status', 'formSelect')?>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label"><?=$this->formLabel($form->get('codeType'));?></label>
                    <div class="controls">
                        <?=$form->input('codeType', 'formRadio', array('class' => 'checkbox inline'))?>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label"><?=$this->formLabel($form->get('visibility'));?></label>
                    <div class="controls">
                        <?=$form->input('visibility', 'formSelect')?>
                    </div>
                </div>

            </fieldset>
        </div>
    </div><!--span5 end-->

    <div class="span10 listing-buttons">
        <button class="btn btn-info btn-large">Save Post</button>
    </div>
</form>
</div>
