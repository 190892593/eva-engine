<?
$post = $this->post;
$title = $post['id'] ? 'Edit Post' : 'Create Post';
$method = $post['id'] ? 'put' : 'post';
$this->headTitle($title, 'SET');
$this->textDelay('breadcrumbText', $title);

if($this->form){
	$form = $this->form;
} else {
    $form = Eva\Api::_()->getForm('\Blog\Form\PostForm');
}
$form->setSubForms(array(
    'Text' => array('Blog\Form\TextForm'),
));
$form->init(array(
    'action' => $this->uri('/admin/blog/'),
    'method' => $method,
    'values' => $this->post
));

//Form usage:
//is error
//$form->subForm('Text')->get('content')->getMessages() ? 'error' : '';
//$form->isError(array('Text', 'content'))


//$this->input($form->subForm('Text')->get('content'), array(
//    'type' => 'formTextarea',
//    'class' => 'span9',
//    'rows' => '15',
//))
//$form->input(array('Text', 'content), 'formTextarea', array('class' => 'span9','rows' => '15',))

//Print out error messages:
//foreach($form->subForm('Text')->get('content')->getMessages() as $message):
?>
<div class="row">
<form <?=$this->formAttr($form)?>>
    <?=$form->restful();?>
    <?=$form->helper('id');?>
    <div class="span10">
        <div class="slate">
            <div class="page-header">
                <?if($post):?>
                <div class="btn-group pull-right">
                    <a href="<?=$this->uri('/blog/page/' . $post['urlName'])?>" class="btn">View</a>
                    <a href="<?=$this->uri('/admin/blog/create')?>" class="btn">Clear Cache</a>
                    <a href="<?=$this->uri('/admin/blog/remove/' . $post['id'], 'c', array('c' => $this->uri('/admin/blog/' . $post['id']))); ?>" class="btn">Delete</a>
                </div>
                <?endif?>
                <h2><?=$title?></h2>
            </div>
            <fieldset class="">
                <div class="control-group <?=$form->isError('title') ? 'error' : '';?>">
                    <?=$form->helper('title', 'label', array('class' => 'control-label'))?>
                    <div class="controls docs-input-sizes">
                        <?=$form->helper('title', array('class' => 'span9'))?>
                        <div class="help-block"><?=$form->helper('title', 'formElementErrors')?></div>
                    </div>
                </div>

                <div class="control-group <?=$form->isError(array('Text', 'content')) ? 'error' : '';?>">
                    <?=$form->helper(array('Text', 'content'), 'label', array('class' => 'control-label'))?>
                    <div class="controls">
                        <?=$form->helper(array('Text', 'content'), 'formTextarea', array('class' => 'span9 editor-markdown','rows' => '15',))?>
                    </div>
                    <div class="markdown-preview"></div>
                    <div class="help-block"><?=$form->helper(array('Text', 'content'), 'formElementErrors')?></div>
                    
                </div>
            </fieldset>
        </div>
    </div><!--span10 end-->

    <div class="span5">
        <div class="slate">
            <div class="page-header">
                <h3>Post Setting</h3>
            </div>
            <fieldset class="form-horizontal">

                <div class="control-group <?=$form->isError('urlName') ? 'error' : '';?>">
                    <?=$form->helper('urlName', 'label', array('class' => 'control-label'))?>
                    <div class="controls">
                        <?=$form->helper('urlName', array('class' => 'input-xlarge'))?>
                        <div class="help-block"><?=$form->helper('urlName', 'formElementErrors')?></div>
                    </div>
                </div>


                <div class="control-group">
                    <?=$form->helper('status', 'label', array('class' => 'control-label'))?>
                    <div class="controls">
                        <?=$form->helper('status', 'formSelect')?>
                    </div>
                </div>

                <div class="control-group">
                    <?=$form->helper('codeType', 'label', array('class' => 'control-label'))?>
                    <div class="controls">
                        <?=$form->helper('codeType', 'formRadio', array('class' => 'checkbox inline'))?>
                    </div>
                </div>
                <div class="control-group">
                    <?=$form->helper('visibility', 'label', array('class' => 'control-label'))?>
                    <div class="controls">
                        <?=$form->helper('visibility', 'formSelect')?>
                    </div>
                </div>

            </fieldset>
        </div>
    </div><!--span5 end-->

    <div class="span10 listing-buttons">
        <button class="btn btn-info btn-large">Save Post</button>
    </div>
</form>
</div>
