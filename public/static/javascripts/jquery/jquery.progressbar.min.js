(function(a){a.extend({progressBar:new function(){this.defaults={steps:20,stepDuration:20,max:100,showText:true,textFormat:"percentage",width:120,height:12,callback:null,boxImage:"/skins/images/progressbar.gif",barImage:{0:"/skins/images/progressbg_red.gif",30:"/skins/images/progressbg_orange.gif",70:"/skins/images/progressbg_green.gif"},running_value:0,value:0,image:null};this.construct=function(c,b){var d=null;var e=null;if(c!=null){if(!isNaN(c)){d=c;if(b!=null){e=b}}else{e=c}}return this.each(function(f){var p=this;var h=this.config;if(d!=null&&this.bar!=null&&this.config!=null){this.config.value=parseInt(d);if(e!=null){p.config=a.extend(this.config,e)}h=p.config}else{var n=a(this);var h=a.extend({},a.progressBar.defaults,e);h.id=n.attr("id")?n.attr("id"):Math.ceil(Math.random()*100000);if(d==null){d=n.html().replace("%","")}h.value=parseInt(d);h.running_value=0;h.image=m(h);var q=["steps","stepDuration","max","width","height","running_value","value"];for(var j=0;j<q.length;j++){h[q[j]]=parseInt(h[q[j]])}n.html("");var l=document.createElement("img");var s=document.createElement("span");var g=a(l);var o=a(s);p.bar=g;g.attr("id",h.id+"_pbImage");o.attr("id",h.id+"_pbText");o.html(r(h));g.attr("title",r(h));g.attr("alt",r(h));g.attr("src",h.boxImage);g.attr("width",h.width);g.css("width",h.width+"px");g.css("height",h.height+"px");g.css("background-image","url("+h.image+")");g.css("background-position",((h.width*-1))+"px 50%");g.css("padding","0");g.css("margin","0");n.append(g);n.append(o)}function k(i){return i.running_value*100/i.max}function m(t){var w=t.barImage;if(typeof(t.barImage)=="object"){for(var v in t.barImage){if(t.running_value>=parseInt(v)){w=t.barImage[v]}else{break}}}return w}function r(i){if(i.showText){if(i.textFormat=="percentage"){return" "+Math.round(i.running_value)+"%"}else{if(i.textFormat=="fraction"){return" "+i.running_value+"/"+i.max}}}}h.increment=Math.round((h.value-h.running_value)/h.steps);if(h.increment<0){h.increment*=-1}if(h.increment<1){h.increment=1}var u=setInterval(function(){var w=h.width/100;if(h.running_value>h.value){if(h.running_value-h.increment<h.value){h.running_value=h.value}else{h.running_value-=h.increment}}else{if(h.running_value<h.value){if(h.running_value+h.increment>h.value){h.running_value=h.value}else{h.running_value+=h.increment}}}if(h.running_value==h.value){clearInterval(u)}var v=a("#"+h.id+"_pbImage");var i=a("#"+h.id+"_pbText");var t=m(h);if(t!=h.image){v.css("background-image","url("+t+")");h.image=t}v.css("background-position",(((h.width*-1))+(k(h)*w))+"px 50%");v.attr("title",r(h));i.html(r(h));if(h.callback!=null&&typeof(h.callback)=="function"){h.callback(h)}p.config=h},h.stepDuration)})}}});a.fn.extend({progressBar:a.progressBar.construct})})(jQuery);
